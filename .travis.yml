language: python

python:
  - "3.9"

stages:
  - lint
  - test
  - name: deploy
    if: branch = main

before_install:
  - sudo apt-get update
  - sudo apt-get -y install tesseract-ocr
  - tesseract --help
  - export PYTHONPATH=$PYTHONPATH:$(pwd)
  - python3 -m pip install --upgrade pip
  - python3 -m pip install poetry

install:
  - poetry install

jobs:
  include:
    - stage: lint
      script: 
      - poetry run lint
      - poetry run bandit
    - stage: test
      script:
      - poetry run coverage
      - poetry run unit_tests
    - stage: deploy
      script:
        - echo "Deploying to PyPI..."
